<%- include('partials/header', { q: '' }) %>
<section class="section">
  <h3>Your Favorites</h3>
  <div class="card-grid">
    <% favorites.forEach(a => { %>
      <a class="card" href="/anime/<%= a.slug %>">
        <img src="<%= a.cover_path || '/public/img/placeholder.svg' %>" alt="<%= a.title %>"/>
        <div class="card-body">
          <h4><%= a.title %></h4>
        </div>
      </a>
    <% }) %>
    <% if (favorites.length === 0) { %>
      <p>No favorites yet.</p>
    <% } %>
  </div>
</section>

<section class="section">
  <h3>Watch History</h3>
  <div class="history-list">
    <% history.forEach(h => { %>
      <a class="history-item" href="/watch/<%= h.episode_id %>">
        <strong><%= h.anime_title %></strong>
        <span>Episode <%= h.number %></span>
        <em>Last at <%= Math.floor(h.last_time) %>s</em>
      </a>
    <% }) %>
    <% if (history.length === 0) { %>
      <p>No history yet.</p>
    <% } %>
  </div>
</section>
<section class="section">
  <h3>Галочка</h3>
  <div class="card">
    <div class="card-body verify-card">
      <div class="verify-row">
        <span>Заявка:</span>
        <% if (verifyRequest && verifyRequest.status === 'pending') { %>
          <strong>На рассмотрении</strong>
        <% } else if (verifyRequest && verifyRequest.status === 'rejected') { %>
          <strong>Отклонена</strong>
        <% } else { %>
          <strong>Не подавалась</strong>
        <% } %>
      </div>
      <div class="verify-row">
        <span>Статус:</span>
        <% if (user && user.is_verified) { %>
          <strong>Подтверждено <img class="checkmark" src="/public/img/checkmark.png" alt="Галочка" /></strong>
        <% } else if (verifyRequest && verifyRequest.status === 'pending') { %>
          <strong>Ожидает</strong>
        <% } else if (verifyRequest && verifyRequest.status === 'rejected') { %>
          <strong>Отклонено</strong>
        <% } else { %>
          <strong>Нет галочки</strong>
        <% } %>
      </div>
      <% if (user && !user.is_verified && (!verifyRequest || verifyRequest.status !== 'pending')) { %>
        <form action="/verify-request" method="post">
          <button class="btn primary">Подать на одобрение</button>
        </form>
      <% } else if (verifyRequest && verifyRequest.status === 'pending') { %>
        <p>Заявка ожидает решения администратора.</p>
      <% } %>
    </div>
  </div>
</section>
<%- include('partials/footer') %>
